<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finamax - Quiz de Empréstimos</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
    <script>
    !function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.install=t():e.install=t()}("undefined"!=typeof window?window:self,(function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=72)}({72:function(e,t,n){"use strict";var o=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var o,r=0,i=t.length;r<i;r++)!o&&r in t||(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,n){var o,i=e.createElement("script");i.type="text/javascript",i.async=!0,i.src=t,n&&(i.onerror=function(){r(e,n)});var a=e.getElementsByTagName("script")[0];null===(o=a.parentNode)||void 0===o||o.insertBefore(i,a)};!function(e,t,n){e.KwaiAnalyticsObject=n;var i=e[n]=e[n]||[];i.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie"];var a=function(e,t){e[t]=function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var i=o([t],n,!0);e.push(i)}};i.methods.forEach((function(e){a(i,e)})),i.instance=function(e){var t,n=(null===(t=i._i)||void 0===t?void 0:t[e])||[];return i.methods.forEach((function(e){a(n,e)})),n},i.load=function(e,o){var a="https://s21-def.ap4r.com/kos/s101/nlav112572/pixel/events.js";i._i=i._i||{},i._i[e]=[],i._i[e]._u=a,i._t=i._t||{},i._t[e]=+new Date,i._o=i._o||{},i._o[e]=o||{};var c="?sdkid=".concat(e,"&lib=").concat(n);r(t,a+c,"https://s21-def.ks-la.net/kos/s101/nlav112572/pixel/events.js"+c)}}(window,document,"kwaiq")}})}));
    </script>
    <script>
    kwaiq.load('286600319955326');
    kwaiq.page();
    kwaiq.track('contentView')
    </script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#820AD1',
                        'primary-hover': '#9434d4',
                        secondary: '#1A202C',
                        success: '#34D399',
                        'success-dark': '#059669',
                        'success-light': '#A7F3D0',
                        danger: '#EF4444',
                        'light-bg': '#F7FAFC',
                    }
                }
            }
        }
    </script>
    <style>
        .progress-bar { height: 8px; transition: width 0.5s ease; }
        .fade-in { animation: fadeIn 0.5s; }
        .fade-out { animation: fadeOut 0.5s forwards; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        .loading-spinner {
            width: 50px; height: 50px; border: 5px solid rgba(26, 32, 44, 0.2);
            border-radius: 50%; border-top-color: #1A202C; animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* Estilos para o Pop-up */
        @keyframes animate-fade-in-scale {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .animate-fade-in-scale {
            animation: animate-fade-in-scale 0.3s ease-out forwards;
        }
    </style>
</head>
<body class="font-sans bg-light-bg">
    <div class="min-h-screen flex flex-col">
        <div class="bg-gray-200 h-2 w-full">
            <div id="progressBar" class="progress-bar bg-primary" style="width: 0%"></div>
        </div>
        
        <header class="bg-white shadow-sm py-4">
            <div class="container mx-auto px-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center">
                        <div class="bg-primary text-white font-bold rounded-lg p-2 mr-3">
                            <span class="text-xl">F</span>
                        </div>
                        <h1 class="text-xl font-bold text-secondary">Finamax</h1>
                    </div>
                    <div class="hidden md:block">
                        <span class="text-gray-600"><i class="fas fa-phone-alt mr-2 text-primary"></i>0800 123 4567</span>
                    </div>
                </div>
            </div>
        </header>
        
        <main class="flex-grow container mx-auto px-4 py-8">
            <form id="quizForm">
                <div id="quizContainer" class="max-w-2xl mx-auto bg-white rounded-xl shadow-md overflow-hidden fade-in">
                    <!-- Step 0: Welcome -->
                    <div id="step0" class="p-8">
                        <div class="text-center mb-8">
                            <h2 class="text-2xl md:text-3xl font-bold text-secondary mb-2">DESCOMPLICAMOS O EMPRÉSTIMO</h2>
                            <p class="text-gray-600">Faça a simulação grátis e descubra seu limite pré-aprovado agora mesmo.</p>
                        </div>
                        <div class="grid md:grid-cols-3 gap-6 mb-8">
                            <div class="text-center p-4 rounded-lg border border-gray-200">
                                <div class="text-primary text-3xl mb-3"><i class="fas fa-bolt"></i></div>
                                <h3 class="font-bold text-secondary mb-2">Aprovação rápida</h3>
                                <p class="text-gray-600 text-sm">Resposta em poucos minutos</p>
                            </div>
                            <div class="text-center p-4 rounded-lg border border-gray-200">
                                <div class="text-primary text-3xl mb-3"><i class="fas fa-percentage"></i></div>
                                <h3 class="font-bold text-secondary mb-2">Taxas acessíveis</h3>
                                <p class="text-gray-600 text-sm">As melhores condições do mercado</p>
                            </div>
                            <div class="text-center p-4 rounded-lg border border-gray-200">
                                <div class="text-primary text-3xl mb-3"><i class="fas fa-headset"></i></div>
                                <h3 class="font-bold text-secondary mb-2">Atendimento especializado</h3>
                                <p class="text-gray-600 text-sm">Consultores prontos para ajudar</p>
                            </div>
                        </div>
                        <div class="text-center">
                            <button type="button" onclick="nextStep()" class="bg-primary hover:bg-primary-hover text-white font-bold py-3 px-8 rounded-full text-lg transition duration-300 transform hover:scale-105">
                                Começar agora <i class="fas fa-arrow-right ml-2"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Step 1: Nome Completo -->
                    <div id="step1" class="hidden p-8">
                        <div class="mb-6">
                            <div class="flex items-center mb-2">
                                <span class="bg-primary text-white rounded-full w-8 h-8 flex items-center justify-center mr-2">1</span>
                                <h2 class="text-xl font-bold text-secondary">Qual é o seu nome completo?</h2>
                            </div>
                            <p class="text-gray-600 md:ml-10 mb-4 text-center md:text-left">Precisamos do seu nome completo para verificar sua identidade.</p>
                        </div>
                        <div class="md:ml-10 mb-6">
                            <input type="text" id="nomeCompleto" name="nomeCompleto" class="w-full px-4 py-3 border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary" placeholder="Digite seu nome completo" required>
                        </div>
                        <div class="md:ml-10 mb-6">
                            <div id="feedback1" class="hidden bg-gray-100 text-secondary p-3 rounded-lg flex items-center">
                                <i class="fas fa-check-circle text-success mr-2"></i>
                                <span>+10% de chance de aprovação</span>
                            </div>
                        </div>
                        <div class="md:ml-10 text-center md:text-right">
                            <button type="button" onclick="nextStep()" class="bg-primary hover:bg-primary-hover text-white font-bold py-3 px-6 rounded-lg transition duration-300 disabled:opacity-50" disabled id="btnStep1">
                                Próxima pergunta <i class="fas fa-arrow-right ml-2"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Step 2: CPF -->
                    <div id="step2" class="hidden p-8">
                        <div class="mb-6">
                            <div class="flex items-center mb-2">
                                <span class="bg-primary text-white rounded-full w-8 h-8 flex items-center justify-center mr-2">2</span>
                                <h2 class="text-xl font-bold text-secondary">Qual é o seu CPF?</h2>
                            </div>
                            <p class="text-gray-600 md:ml-10 mb-4 text-center md:text-left">Seu CPF é necessário para consulta de crédito.</p>
                        </div>
                        <div class="md:ml-10 mb-6">
                            <input type="text" id="cpf" name="cpf" class="w-full px-4 py-3 border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary" placeholder="Digite seu CPF" required>
                        </div>
                        <div class="md:ml-10 text-center text-xs text-gray-500 mb-6">
                            <i class="fas fa-lock mr-1"></i> Seus dados estão 100% seguros e protegidos.
                        </div>
                        <p id="cpfError" class="text-danger text-center text-sm my-4 hidden md:ml-10"><i class="fas fa-exclamation-circle mr-1"></i> CPF inválido. Por favor, verifique os dígitos.</p>
                        <div class="md:ml-10 mb-6">
                            <div id="feedback2" class="hidden bg-gray-100 text-secondary p-3 rounded-lg flex items-center">
                                <i class="fas fa-check-circle text-success mr-2"></i>
                                <span>+25% de chance de aprovação</span>
                            </div>
                        </div>
                        <div class="md:ml-10 flex justify-center md:justify-end">
                            <button type="button" onclick="nextStep()" class="bg-primary hover:bg-primary-hover text-white font-bold py-3 px-6 rounded-lg transition duration-300 disabled:opacity-50" disabled id="btnStep2">
                                Próxima pergunta <i class="fas fa-arrow-right ml-2"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Step 3: Telefone -->
                    <div id="step3" class="hidden p-8">
                        <div class="mb-6">
                            <div class="flex items-center mb-2">
                                <span class="bg-primary text-white rounded-full w-8 h-8 flex items-center justify-center mr-2">3</span>
                                <h2 class="text-xl font-bold text-secondary">Qual é o seu telefone?</h2>
                            </div>
                            <p class="text-gray-600 md:ml-10 mb-4 text-center md:text-left">Precisamos do seu telefone para entrar em contato.</p>
                        </div>
                        <div class="md:ml-10 mb-6">
                            <input type="text" id="telefone" name="telefone" class="w-full px-4 py-3 border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary" placeholder="Digite seu telefone com DDD" required>
                        </div>
                        <div class="md:ml-10 mb-6">
                            <div id="feedback3" class="hidden bg-gray-100 text-secondary p-3 rounded-lg flex items-center">
                                <i class="fas fa-check-circle text-success mr-2"></i>
                                <span>+40% de chance de aprovação</span>
                            </div>
                        </div>
                        <div class="md:ml-10 flex justify-center md:justify-end">
                            <button type="button" onclick="nextStep()" class="bg-primary hover:bg-primary-hover text-white font-bold py-3 px-6 rounded-lg transition duration-300 disabled:opacity-50" disabled id="btnStep3">
                                Próxima pergunta <i class="fas fa-arrow-right ml-2"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Step 4: Valor Desejado -->
                    <div id="step4" class="hidden p-8">
                        <div class="mb-6">
                            <div class="flex items-center mb-2">
                                <span class="bg-primary text-white rounded-full w-8 h-8 flex items-center justify-center mr-2">4</span>
                                <h2 class="text-xl font-bold text-secondary">Qual valor você deseja?</h2>
                            </div>
                            <p class="text-gray-600 md:ml-10 mb-4 text-center md:text-left">Selecione o valor que melhor atende suas necessidades.</p>
                        </div>
                        <div class="md:ml-10 mb-6 grid grid-cols-2 gap-4">
                            <button type="button" onclick="selectValue(5000, event)" class="value-btn bg-white hover:bg-gray-100 border border-gray-300 text-gray-800 font-bold py-4 px-4 rounded-lg transition duration-300">R$ 5.000</button>
                            <button type="button" onclick="selectValue(10000, event)" class="value-btn bg-white hover:bg-gray-100 border border-gray-300 text-gray-800 font-bold py-4 px-4 rounded-lg transition duration-300">R$ 10.000</button>
                            <button type="button" onclick="selectValue(20000, event)" class="value-btn bg-white hover:bg-gray-100 border border-gray-300 text-gray-800 font-bold py-4 px-4 rounded-lg transition duration-300">R$ 20.000</button>
                            <button type="button" onclick="selectValue(30000, event)" class="value-btn bg-white hover:bg-gray-100 border border-gray-300 text-gray-800 font-bold py-4 px-4 rounded-lg transition duration-300">R$ 30.000</button>
                            <button type="button" onclick="selectValue(50000, event)" class="value-btn bg-white hover:bg-gray-100 border border-gray-300 text-gray-800 font-bold py-4 px-4 rounded-lg transition duration-300">R$ 50.000</button>
                            <button type="button" onclick="showCustomValue(event)" class="value-btn bg-white hover:bg-gray-100 border border-gray-300 text-gray-800 font-bold py-4 px-4 rounded-lg transition duration-300">Outro valor</button>
                        </div>
                        <div id="customValueContainer" class="md:ml-10 mb-6 hidden">
                            <input type="number" id="customValue" max="100000" class="w-full px-4 py-3 border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary" placeholder="Digite o valor desejado">
                            <p class="text-xs text-gray-500 mt-2">O valor máximo é de R$ 100.000.</p>
                        </div>
                        <!-- Campo oculto para armazenar o valor -->
                        <input type="hidden" id="valor" name="valor" value="0">

                        <div class="md:ml-10 mb-6">
                            <div id="feedback4" class="hidden bg-gray-100 text-secondary p-3 rounded-lg flex items-center">
                                <i class="fas fa-check-circle text-success mr-2"></i>
                                <span>+70% de chance de aprovação</span>
                            </div>
                        </div>

                        <p id="submitError" class="text-danger text-center text-sm my-4 hidden md:ml-10"><i class="fas fa-exclamation-circle mr-1"></i></p>
                        
                        <div class="md:ml-10 flex justify-center md:justify-end">
                            <button type="button" onclick="submitQuiz()" class="bg-primary hover:bg-primary-hover text-white font-bold py-3 px-6 rounded-lg transition duration-300 disabled:opacity-50" disabled id="btnStep4">
                                Finalizar <i class="fas fa-check ml-2"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Step 5: Loading -->
                    <div id="step5" class="hidden p-8">
                        <div class="text-center py-12">
                            <div class="loading-spinner mx-auto mb-8"></div>
                            <h2 class="text-2xl font-bold text-secondary mb-4">Estamos analisando sua solicitação...</h2>
                            <p id="loadingMessage" class="text-gray-600 h-6"></p>
                        </div>
                    </div>
                    
                    <!-- Step 6: Result -->
                    <div id="step6" class="hidden p-8">
                        <div class="text-center py-8">
                            <div class="bg-success-light text-success rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-6">
                                <i class="fas fa-check-circle text-4xl"></i>
                            </div>
                            <h2 id="greetingMessage" class="text-3xl font-bold text-secondary mb-4">Parabéns!</h2>
                            <p class="text-xl text-gray-700 mb-6">Sua análise foi concluída com sucesso.</p>
                            
                            <div class="bg-gray-100 rounded-xl p-6 max-w-md mx-auto mb-8">
                                <p class="text-gray-600 mb-2">Valor pré-aprovado:</p>
                                <p class="text-3xl font-bold text-secondary mb-4" id="approvedValue">R$ 0,00</p>
                                <div class="w-full bg-gray-200 rounded-full h-4">
                                    <div class="bg-success h-4 rounded-full" style="width: 95%"></div>
                                </div>
                                <p class="text-gray-600 mt-2">Sua chance de aprovação está em <span class="font-bold">95%</span></p>
                            </div>
                            
                            <button type="button" id="whatsappBtn" onclick="showPrestamistaPopup()" class="inline-block bg-success hover:bg-success-dark text-white font-bold py-4 px-8 rounded-full text-lg transition duration-300 transform hover:scale-105 pulse">
                                <i class="fab fa-whatsapp mr-2"></i> Falar agora com um consultor especialista
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </main>
        
        <footer class="bg-secondary text-white py-8">
            <div class="container mx-auto px-4">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <div class="mb-4 md:mb-0 text-center md:text-left">
                        <div class="flex items-center justify-center md:justify-start">
                            <div class="bg-white text-primary font-bold rounded-lg p-2 mr-3">
                                <span class="text-xl">F</span>
                            </div>
                            <h3 class="text-xl font-bold">Finamax</h3>
                        </div>
                        <p class="text-sm opacity-80 mt-2">Soluções financeiras inteligentes</p>
                    </div>
                    <div class="text-xs opacity-80 text-center md:text-right space-y-1 mt-4 md:mt-0">
                        <p>Copyright © 2024 Todos os Direitos Reservados</p>
                        <p>Finamax - CNPJ/MF sob o número 00.411.939/0001-49</p>
                        <p>Finamax, Crédito, Financiamento e Investimento S.A, instituição financeira de direito privado, <br class="hidden md:block"> sediada na Rua Rangel Pestana, 681, Centro, Jundiaí, estado de São Paulo, CEP 13.201-000</p>
                    </div>
                </div>
            </div>
        </footer>
    </div>
    
    <!-- Modal Prestamista -->
    <div id="prestamistaModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white rounded-xl shadow-2xl max-w-lg w-full flex flex-col max-h-[90vh] animate-fade-in-scale">
            <!-- Cabeçalho do Modal -->
            <div class="p-6 border-b relative">
                <h3 class="text-xl sm:text-2xl font-bold text-secondary text-center">Parabéns! Sua solicitação foi aprovada com sucesso.</h3>
                <button onclick="closePrestamistaPopup()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-800 text-2xl">&times;</button>
            </div>
            
            <!-- Conteúdo com scroll -->
            <div class="p-6 overflow-y-auto">
                <p class="text-gray-600 text-left text-sm sm:text-base space-y-4">
                    Para concluirmos o processo, é necessária a contratação do seguro.
                    <br><br>
                    Esse seguro é responsável por cobrir situações como perda de emprego, acidente, invalidez ou problemas de saúde que possam comprometer o pagamento das parcelas mensais.
                    <br><br>
                    O valor da contratação é de <strong>R$ 149,99</strong>, podendo ser pago via PIX ou em qualquer lotérica.
                    <br><br>
                    Caso tenha interesse em contratar o seguro e receber o valor do empréstimo em sua conta, clique no botão abaixo e fale diretamente com um de nossos atendentes.
                </p>
            </div>
            
            <!-- Rodapé do Modal com Botão -->
            <div class="p-6 border-t">
                 <button id="saqueBtn" class="w-full bg-success hover:bg-success-dark text-white font-bold py-3 sm:py-4 rounded-full text-base sm:text-lg transition duration-300 transform hover:scale-105">
                    <i class="fas fa-money-check-alt mr-2"></i> Efetuar Saque
                </button>
            </div>
        </div>
    </div>


    <script>
        let currentStep = 0;
        let selectedValue = 0;
        let whatsappUrl = ''; // Variavel global para guardar a URL do WhatsApp

        // ⚠️ COLE A SUA NOVA URL DE IMPLANTAÇÃO AQUI ⚠️
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw4XKZV__D8gYrCVMiABezllNRmcxd4hlxc2iiV5Xhr3YNW2IheuiQNc64DO0ZfLBq9/exec';

        function testaCPF(strCPF) {
            let Soma;
            let Resto;
            let strCPFlimpo = strCPF.replace(/\D/g, '');
            Soma = 0;
            if (strCPFlimpo.length !== 11 || /^(\d)\1{10}$/.test(strCPFlimpo)) return false;
            for (let i=1; i<=9; i++) Soma += parseInt(strCPFlimpo.substring(i-1, i)) * (11 - i);
            Resto = (Soma * 10) % 11;
            if ((Resto == 10) || (Resto == 11))  Resto = 0;
            if (Resto != parseInt(strCPFlimpo.substring(9, 10)) ) return false;
            Soma = 0;
            for (let i = 1; i <= 10; i++) Soma += parseInt(strCPFlimpo.substring(i-1, i)) * (12 - i);
            Resto = (Soma * 10) % 11;
            if ((Resto == 10) || (Resto == 11))  Resto = 0;
            if (Resto != parseInt(strCPFlimpo.substring(10, 11) ) ) return false;
            return true;
        }
        
        $(document).ready(function() {
            $('#cpf').mask('000.000.000-00', {reverse: true});
            $('#telefone').mask('(00) 00000-0000');
            
            $('#nomeCompleto').on('input', validateStep1);
            $('#cpf').on('input', validateStep2);
            $('#telefone').on('input', validateStep3);
            $('#customValue').on('input', validateStep4);

            // Ação do botão "Efetuar Saque" no pop-up
            $('#saqueBtn').on('click', function() {
                if (whatsappUrl) {
                    window.location.href = whatsappUrl;
                }
            });
        });
        
        function nextStep() {
            if (currentStep === 1) {
                if (!validateStep1(true)) return;
                $('#feedback1').removeClass('hidden');
            } else if (currentStep === 2) {
                if (!validateStep2(true)) return;
                $('#feedback2').removeClass('hidden');
            } else if (currentStep === 3) {
                 if (!validateStep3(true)) return;
                $('#feedback3').removeClass('hidden');
            }
            
            $(`#step${currentStep}`).addClass('hidden');
            currentStep++;
            $(`#step${currentStep}`).removeClass('hidden').addClass('fade-in');
            
            updateProgressBar();
        }
        
        function updateProgressBar() {
            const progress = (currentStep / 4) * 100;
            $('#progressBar').css('width', `${progress}%`);
        }
        
        function validateStep1(showAlert = false) {
            const nome = $('#nomeCompleto').val();
            const isValid = nome.trim().split(' ').length >= 2 && nome.length > 5;
            $('#btnStep1').prop('disabled', !isValid);
            return isValid;
        }
        
        function validateStep2(showAlert = false) {
            const cpf = $('#cpf').val();
            const cpfLimpo = cpf.replace(/\D/g, '');
            const isLengthValid = cpfLimpo.length === 11;
            let isValid = false;
            
            if (isLengthValid) {
                if (!testaCPF(cpf)) {
                    $('#cpfError').removeClass('hidden');
                    isValid = false;
                } else {
                    $('#cpfError').addClass('hidden');
                    isValid = true;
                }
            } else {
                $('#cpfError').addClass('hidden');
            }
            $('#btnStep2').prop('disabled', !isValid);
            return isValid;
        }
        
        function validateStep3(showAlert = false) {
            const telefone = $('#telefone').val();
            const isValid = telefone.replace(/\D/g, '').length === 11;
            $('#btnStep3').prop('disabled', !isValid);
            return isValid;
        }
        
        function validateStep4() {
            const customValue = $('#customValue').val();
            const isValid = customValue > 0 && customValue <= 100000;
            $('#btnStep4').prop('disabled', !isValid);
            
            if (isValid) {
                selectedValue = parseFloat(customValue);
                $('#valor').val(selectedValue);
                $('#feedback4').removeClass('hidden');
            } else {
                $('#feedback4').addClass('hidden');
            }
        }
        
        function selectValue(value, event) {
            selectedValue = value;
            $('#valor').val(selectedValue);
            $('#btnStep4').prop('disabled', false);
            $('#feedback4').removeClass('hidden');
            
            $('.value-btn').removeClass('bg-primary text-white border-primary').addClass('bg-white text-gray-800 border-gray-300');
            $(event.currentTarget).removeClass('bg-white text-gray-800 border-gray-300').addClass('bg-primary text-white border-primary');

            $('#customValueContainer').addClass('hidden');
            $('#customValue').val('');
        }
        
        function showCustomValue(event) {
            $('#customValueContainer').removeClass('hidden').find('input').focus();
            $('.value-btn').removeClass('bg-primary text-white border-primary').addClass('bg-white text-gray-800 border-gray-300');
            $(event.currentTarget).addClass('bg-primary text-white border-primary');
            $('#btnStep4').prop('disabled', true);
            $('#feedback4').addClass('hidden');
            selectedValue = 0;
            $('#valor').val(selectedValue);
        }

        let loadingInterval;
        function startLoadingMessages() {
            const messages = ["Verificando seus dados...","Isso costuma levar menos de 1 minuto...","Buscando as melhores condições para você...","Não feche ou recarregue a página durante a análise...","Quase pronto!"];
            let messageIndex = 0;
            const loadingMessageElement = $('#loadingMessage');
            loadingMessageElement.text(messages[messageIndex]).addClass('fade-in');
            loadingInterval = setInterval(() => {
                loadingMessageElement.removeClass('fade-in').addClass('fade-out');
                setTimeout(() => {
                    messageIndex = (messageIndex + 1) % messages.length;
                    loadingMessageElement.text(messages[messageIndex]).removeClass('fade-out').addClass('fade-in');
                }, 500);
            }, 2000);
        }

        function stopLoadingMessages() {
            clearInterval(loadingInterval);
        }
        
        async function submitQuiz() {
            const submitButton = $('#btnStep4');
            submitButton.prop('disabled', true).html('<div class="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mx-auto"></div>');
            
            $(`#step${currentStep}`).addClass('hidden');
            currentStep++;
            $(`#step${currentStep}`).removeClass('hidden').addClass('fade-in');
            startLoadingMessages();

            const form = document.getElementById('quizForm');
            const formData = new FormData(form);

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: formData,
                });
                
                const resultText = await response.text();
                const result = JSON.parse(resultText);
                
                stopLoadingMessages();

                if (result.result === "success") {
                    showResult();
                } else {
                    console.error('Erro retornado pelo script:', result.message);
                    currentStep--;
                    $('#step5').addClass('hidden');
                    $('#step4').removeClass('hidden');
                    $('#submitError').text(result.message || 'Ocorreu um erro. Tente novamente.').removeClass('hidden');
                    submitButton.prop('disabled', false).html('Finalizar <i class="fas fa-check ml-2"></i>');
                }

            } catch (error) {
                console.error('Erro de conexão:', error);
                stopLoadingMessages();
                currentStep--;
                $('#step5').addClass('hidden');
                $('#step4').removeClass('hidden');
                $('#submitError').text('Ocorreu um erro ao processar a resposta. Tente novamente.').removeClass('hidden');
                submitButton.prop('disabled', false).html('Finalizar <i class="fas fa-check ml-2"></i>');
            }
        }
        
        function showResult() {
            $('#step5').addClass('hidden');
            currentStep = 6;
            $('#step6').removeClass('hidden').addClass('fade-in');
            
            const firstName = $('#nomeCompleto').val().split(' ')[0];
            $('#greetingMessage').html(`Parabéns, ${firstName}!`);
            
            const randomFactor = 0.9 + Math.random() * 0.1; 
            const approvedValue = selectedValue * randomFactor;
            
            const formattedValue = approvedValue.toLocaleString('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            });
            
            $('#approvedValue').text(formattedValue);
            
            const whatsappNumber = "5511967210649";
            const whatsappMessage = `Olá, me chamo ${$('#nomeCompleto').val()} e gostaria de mais informações sobre o empréstimo pré-aprovado no valor de ${formattedValue}.`;
            whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(whatsappMessage)}`;
        }

        // Funções do Pop-up
        function showPrestamistaPopup() {
            $('#prestamistaModal').removeClass('hidden');
        }

        function closePrestamistaPopup() {
            $('#prestamistaModal').addClass('hidden');
        }
    </script>
</body>
</html>

